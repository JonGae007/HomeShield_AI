<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="/static/account.css">
    <link rel="icon" type="image/x-icon" href="/static/icons/logo.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accountverwaltung</title>
</head>
<body>
    <div class="sidebar">
        <div class="logo">
            <img src="/static/icons/logo.png" alt="HomeShieldAI">
            <h2>HomeShieldAI</h2>
        </div>
        <ul class="menu">
            <li><a href="/dashboard"><img src="/static/icons/dashboard.png" alt="Dashboard Icon"> Dashboard</a></li>
            <li><a href="/recordings"><img src="/static/icons/play.png" alt="Recordings Icon"> Aufzeichnungen</a></li>
            <li><a href="/faces"><img src="/static/icons/face.png" alt="Face Icon"> Gesichter</a></li>
            <li><a href="/face-detection-log"><img src="/static/icons/log.png" alt="Detection Log Icon"> Erkennungs-Log</a></li>
            <li><a href="/settings"  class="active"><img src="/static/icons/settings.png" alt="Settings Icon"> Einstellungen</a></li>
        </ul>
        <footer>
            <p>Created by Raik and Jonas</p>
        </footer>
    </div>
    <a href="/account" class="topbar">
        <img src="/static/icons/user.png" alt="User Icon">
        {{ username }}
    </a>
    <div class="content">
        
        <!-- Fehlermeldungen und Erfolgsmeldungen -->
        {% if error %}
        <div class="alert alert-error">
            <span class="alert-icon">‚ö†Ô∏è</span>
            {{ error }}
        </div>
        {% endif %}
        
        {% if success %}
        <div class="alert alert-success">
            <span class="alert-icon">‚úÖ</span>
            {{ success }}
        </div>
        {% endif %}
        
        <div class="account-container">
            <!-- Benutzerprofil Header -->
            <div class="profile-header">
                <div class="profile-avatar">
                    <img src="/static/icons/user.png" alt="User Avatar">
                </div>
                <div class="profile-details">
                    <h2 class="profile-name">{{ username }}</h2>
                    <p class="profile-role">Administrator</p>
                </div>
            </div>

            <!-- Account Einstellungen Grid -->
            <div class="settings-grid">
                <!-- Sicherheit Karte -->
                <div class="account-card security-card">
                    <div class="card-header">
                        <div class="card-icon security">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M12,7C13.4,7 14.8,8.6 14.8,10V11.5C15.4,11.5 16,12.1 16,12.7V16.2C16,16.8 15.4,17.3 14.8,17.3H9.2C8.6,17.3 8,16.8 8,16.2V12.7C8,12.1 8.6,11.5 9.2,11.5V10C9.2,8.6 10.6,7 12,7M12,8.2C11.2,8.2 10.5,8.7 10.5,10V11.5H13.5V10C13.5,8.7 12.8,8.2 12,8.2Z"/>
                            </svg>
                        </div>
                        <div>
                            <h3>Sicherheit & Passwort</h3>
                            <p>Verwalten Sie Ihre Anmeldedaten</p>
                        </div>
                    </div>
                    <form method="POST" action="/change_password" class="modern-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="old_password">Aktuelles Passwort</label>
                                <div class="input-wrapper">
                                    <input type="password" id="old_password" name="old_password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                                    <span class="input-icon">üîí</span>
                                </div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="new_password">Neues Passwort</label>
                                <div class="input-wrapper">
                                    <input type="password" id="new_password" name="new_password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                                    <span class="input-icon">üîë</span>
                                </div>
                                <div class="password-strength" id="passwordStrength"></div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="confirm_password">Passwort best√§tigen</label>
                                <div class="input-wrapper">
                                    <input type="password" id="confirm_password" name="confirm_password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                                    <span class="input-icon">‚úÖ</span>
                                </div>
                            </div>
                        </div>
                        <button type="submit" class="btn-modern btn-primary">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"/>
                            </svg>
                            Passwort aktualisieren
                        </button>
                    </form>
                </div>

                <!-- Gefahr Zone Karte -->
                <div class="account-card danger-card">
                    <div class="card-header">
                        <div class="card-icon danger">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M13,14H11V10H13M13,18H11V16H13M1,21H23L12,2L1,21Z"/>
                            </svg>
                        </div>
                        <div>
                            <h3>Gefahr Zone</h3>
                            <p>Irreversible Account-Aktionen</p>
                        </div>
                    </div>
                    <div class="danger-content">
                        <div class="action-buttons">
                            <a href="/logout" class="btn-modern btn-secondary">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M16,17V14H9V10H16V7L21,12L16,17M14,2A2,2 0 0,1 16,4V6H14V4H5V20H14V18H16V20A2,2 0 0,1 14,22H5A2,2 0 0,1 3,20V4A2,2 0 0,1 5,2H14Z"/>
                                </svg>
                                Abmelden
                            </a>
                        </div>
                        <div class="warning-box">
                            <h4>‚ö†Ô∏è Account l√∂schen</h4>
                            <p>Diese Aktion kann nicht r√ºckg√§ngig gemacht werden. Alle Ihre Daten, Einstellungen und Aufzeichnungen werden permanent gel√∂scht.</p>
                        </div>
                        <button type="button" class="btn-modern btn-danger" onclick="confirmDeleteAccount()">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"/>
                            </svg>
                            Account permanent l√∂schen
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Delete Account Modal -->
        <div id="deleteModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Account l√∂schen</h3>
                    <span class="close" onclick="closeDeleteModal()">&times;</span>
                </div>
                <div class="modal-body">
                    <p>‚ö†Ô∏è <strong>Warnung:</strong> Diese Aktion kann nicht r√ºckg√§ngig gemacht werden!</p>
                    <p>Wenn Sie Ihren Account l√∂schen, werden alle Ihre Daten unwiderruflich gel√∂scht.</p>
                    <p>Geben Sie zur Best√§tigung Ihr Passwort ein:</p>
                    <form method="POST" action="/delete_account" id="deleteForm">
                        <input type="password" name="password" placeholder="Passwort zur Best√§tigung" required>
                        <div class="modal-buttons">
                            <button type="button" class="btn-account btn-secondary" onclick="closeDeleteModal()">Abbrechen</button>
                            <button type="submit" class="btn-account btn-danger">Account endg√ºltig l√∂schen</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <script>
            function confirmDeleteAccount() {
                document.getElementById('deleteModal').style.display = 'block';
            }

            function closeDeleteModal() {
                document.getElementById('deleteModal').style.display = 'none';
            }

            // Close modal when clicking outside of it
            window.onclick = function(event) {
                const modal = document.getElementById('deleteModal');
                if (event.target == modal) {
                    modal.style.display = 'none';
                }
            }

            // Password strength indicator
            document.getElementById('new_password').addEventListener('input', function(e) {
                const password = e.target.value;
                const strengthDiv = document.getElementById('passwordStrength');
                
                let strength = 0;
                let feedback = [];
                
                if (password.length >= 8) strength += 1;
                else feedback.push('Mindestens 8 Zeichen');
                
                if (/[a-z]/.test(password)) strength += 1;
                else feedback.push('Kleinbuchstaben');
                
                if (/[A-Z]/.test(password)) strength += 1;
                else feedback.push('Gro√übuchstaben');
                
                if (/[0-9]/.test(password)) strength += 1;
                else feedback.push('Zahlen');
                
                if (/[^A-Za-z0-9]/.test(password)) strength += 1;
                else feedback.push('Sonderzeichen');
                
                const levels = ['Sehr schwach', 'Schwach', 'Mittel', 'Stark', 'Sehr stark'];
                const colors = ['#ff4757', '#ff6b7d', '#ffa502', '#2ed573', '#1dd1a1'];
                
                if (password.length > 0) {
                    strengthDiv.innerHTML = `
                        <div class="strength-bar">
                            <div class="strength-fill" style="width: ${(strength / 5) * 100}%; background-color: ${colors[strength-1] || colors[0]}"></div>
                        </div>
                        <span class="strength-text" style="color: ${colors[strength-1] || colors[0]}">${levels[strength-1] || levels[0]}</span>
                        ${feedback.length > 0 ? `<small>Fehlt: ${feedback.join(', ')}</small>` : ''}
                    `;
                } else {
                    strengthDiv.innerHTML = '';
                }
            });

            // Password confirmation validation
            document.getElementById('confirm_password').addEventListener('input', function(e) {
                const newPassword = document.getElementById('new_password').value;
                const confirmPassword = e.target.value;
                const wrapper = e.target.closest('.input-wrapper');
                
                if (confirmPassword.length > 0) {
                    if (newPassword === confirmPassword) {
                        wrapper.classList.add('valid');
                        wrapper.classList.remove('invalid');
                    } else {
                        wrapper.classList.add('invalid');
                        wrapper.classList.remove('valid');
                    }
                } else {
                    wrapper.classList.remove('valid', 'invalid');
                }
            });
        </script>
    </div>
</body>
</html>
