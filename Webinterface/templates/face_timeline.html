<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="icon" type="image/x-icon" href="/static/icons/logo.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesichtserkennung Timeline</title>
    <style>
        .face-timeline-container {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .timeline-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: #fff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #333;
        }
        
        .stat-number.known { color: #4CAF50; }
        .stat-number.unknown { color: #f44336; }
        .stat-number.total { color: #2196F3; }
        
        .stat-label {
            display: block;
            margin-top: 5px;
            color: #666;
            font-size: 0.9em;
        }
        
        .timeline-content {
            background: #fff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .timeline-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }
        
        .timeline-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
        }
        
        .timeline-filter {
            display: flex;
            gap: 10px;
        }
        
        .filter-btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background: #fff;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
        }
        
        .filter-btn.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }
        
        .timeline-list {
            max-height: 600px;
            overflow-y: auto;
        }
        
        .timeline-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-left: 4px solid #ddd;
            margin-bottom: 10px;
            position: relative;
            background: #f9f9f9;
            border-radius: 0 4px 4px 0;
        }
        
        .timeline-item.known {
            border-left-color: #4CAF50;
            background: #f1f8e9;
        }
        
        .timeline-item.unknown {
            border-left-color: #f44336;
            background: #ffebee;
        }
        
        .timeline-time {
            min-width: 100px;
            font-weight: bold;
            color: #666;
            font-size: 0.9em;
        }
        
        .timeline-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 15px;
            font-size: 1.2em;
        }
        
        .timeline-icon.known {
            background: #4CAF50;
            color: white;
        }
        
        .timeline-icon.unknown {
            background: #f44336;
            color: white;
        }
        
        .timeline-details {
            flex: 1;
        }
        
        .timeline-name {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 4px;
        }
        
        .timeline-confidence {
            font-size: 0.9em;
            color: #666;
        }
        
        .timeline-date {
            font-size: 0.8em;
            color: #999;
            margin-left: auto;
            min-width: 80px;
            text-align: right;
        }
        
        .no-detections {
            text-align: center;
            padding: 40px;
            color: #666;
            font-style: italic;
        }
        
        .refresh-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
        }
        
        .refresh-btn:hover {
            background: #0056b3;
        }
        
        .timeline-chart {
            margin-bottom: 30px;
            background: #fff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .chart-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }
        
        .hour-chart {
            display: grid;
            grid-template-columns: repeat(24, 1fr);
            gap: 2px;
            height: 100px;
            margin: 10px 0;
        }
        
        .hour-bar {
            background: #e0e0e0;
            position: relative;
            border-radius: 2px;
            min-height: 20px;
        }
        
        .hour-bar.has-detections {
            background: linear-gradient(to top, #4CAF50 0%, #81C784 100%);
        }
        
        .hour-label {
            font-size: 0.7em;
            text-align: center;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <h1>Gesichtserkennung Timeline</h1>
    <div class="sidebar">
        <div class="logo">
            <img src="/static/icons/logo.png" alt="HomeShieldAI">
            <h2>HomeShieldAI</h2>
        </div>
        <ul class="menu">
            <li><a href="/dashboard"><img src="/static/icons/dashboard.png" alt="Dashboard Icon"> Dashboard</a></li>
            <li><a href="/recordings"><img src="/static/icons/play.png" alt="Recordings Icon"> Aufzeichnungen</a></li>
            <li><a href="/face_timeline" class="active"><img src="/static/icons/face.png" alt="Face Timeline Icon"> Gesichtserkennung</a></li>
            <li><a href="/settings"><img src="/static/icons/settings.png" alt="Settings Icon"> Einstellungen</a></li>
        </ul>
        <footer>
            <p>Created by Raik and Jonas</p>
        </footer>
    </div>
    <a href="/account" class="topbar">
        <img src="/static/icons/user.png" alt="User Icon">
        {{ username }}
    </a>
    
    <div class="content">
        <div class="face-timeline-container">
            <!-- Statistiken -->
            <div class="timeline-stats">
                <div class="stat-card">
                    <span class="stat-number total">{{ statistics.total_detections }}</span>
                    <span class="stat-label">Gesamt erkannt (24h)</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number known">{{ statistics.known_faces }}</span>
                    <span class="stat-label">Bekannte Gesichter</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number unknown">{{ statistics.unknown_faces }}</span>
                    <span class="stat-label">Unbekannte Gesichter</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">{{ statistics.unique_faces }}</span>
                    <span class="stat-label">Verschiedene Personen</span>
                </div>
            </div>
            
            <!-- Stunden-Chart -->
            <div class="timeline-chart">
                <div class="chart-title">Aktivit√§t der letzten 24 Stunden</div>
                <div class="hour-chart" id="hour-chart">
                    <!-- Wird mit JavaScript gef√ºllt -->
                </div>
            </div>
            
            <!-- Timeline -->
            <div class="timeline-content">
                <div class="timeline-header">
                    <h2 class="timeline-title">Erkennungs-Timeline</h2>
                    <div class="timeline-controls">
                        <div class="timeline-filter">
                            <button class="filter-btn active" onclick="filterDetections('all')">Alle</button>
                            <button class="filter-btn" onclick="filterDetections('known')">Bekannte</button>
                            <button class="filter-btn" onclick="filterDetections('unknown')">Unbekannte</button>
                        </div>
                        <button class="refresh-btn" onclick="refreshTimeline()">Aktualisieren</button>
                    </div>
                </div>
                
                <div class="timeline-list" id="timeline-list">
                    {% if detections %}
                        {% for detection in detections %}
                        <div class="timeline-item {{ 'known' if detection.is_known else 'unknown' }}" data-type="{{ 'known' if detection.is_known else 'unknown' }}">
                            <div class="timeline-time">{{ detection.formatted_time }}</div>
                            <div class="timeline-icon {{ 'known' if detection.is_known else 'unknown' }}">
                                {% if detection.is_known %}
                                    üë§
                                {% else %}
                                    ‚ùì
                                {% endif %}
                            </div>
                            <div class="timeline-details">
                                <div class="timeline-name">{{ detection.name }}</div>
                                <div class="timeline-confidence">Genauigkeit: {{ detection.confidence }}%</div>
                            </div>
                            <div class="timeline-date">{{ detection.formatted_date }}</div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="no-detections">
                            Noch keine Gesichtserkennungen in den letzten 24 Stunden
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let currentFilter = 'all';
        
        // Timeline aktualisieren
        function refreshTimeline() {
            console.log('Refreshing timeline...');
            location.reload();
        }
        
        // Filter f√ºr Erkennungen
        function filterDetections(type) {
            currentFilter = type;
            
            // Update Filter Buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Filter Timeline Items
            const items = document.querySelectorAll('.timeline-item');
            items.forEach(item => {
                const itemType = item.getAttribute('data-type');
                
                if (type === 'all' || type === itemType) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }
        
        // Stunden-Chart erstellen
        function createHourChart() {
            const chart = document.getElementById('hour-chart');
            if (!chart) return;
            
            // Erstelle 24 Stunden-Balken
            for (let hour = 0; hour < 24; hour++) {
                const barContainer = document.createElement('div');
                barContainer.style.display = 'flex';
                barContainer.style.flexDirection = 'column';
                barContainer.style.alignItems = 'center';
                
                const bar = document.createElement('div');
                bar.className = 'hour-bar';
                bar.title = `${hour}:00 - ${hour + 1}:00`;
                
                const label = document.createElement('div');
                label.className = 'hour-label';
                label.textContent = hour.toString().padStart(2, '0');
                
                barContainer.appendChild(bar);
                barContainer.appendChild(label);
                chart.appendChild(barContainer);
            }
        }
        
        // Auto-refresh alle 60 Sekunden
        function startAutoRefresh() {
            setInterval(() => {
                console.log('Auto-refreshing timeline data...');
                // Hier k√∂nnten wir nur die Daten per API laden statt die ganze Seite zu refreshen
            }, 60000);
        }
        
        // Initialisierung
        document.addEventListener('DOMContentLoaded', function() {
            createHourChart();
            startAutoRefresh();
        });
    </script>
</body>
</html>